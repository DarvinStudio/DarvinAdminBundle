Добавление раздела администрирования
====================================

**1. Создаем файл конфигурации раздела в формате YAML.**

Конфигурация описана в [справочнике](reference/admin_section_configuration.md). По договоренности файл конфигурации
 должен располагаться в каталоге "Resources/config/admin" вашего бандла и иметь имя, отражающее название сущности, для
 администрирования которой создается раздел. Примеры конфигурации можно найти в каталоге "Resources/config/admin" этого
 бандла.
  
Конфигурационный файл может наследоваться от другого. Для этого необходимо добавить в него ключ "extends", значением
 которого должен быть путь до конфига-родителя. Путь может быть относительным бандла, в таком случае он должен начинаться
 с символа "@". Пример:
 
```yaml
extends: "@DarvinUserBundle/Resources/config/admin/user.yml"
```

При наследовании по умолчанию происходит объединение параметров алгоритмом, аналогичным реализованному в функции
 "array_replace_recursive()", но также доступны следующие возможности:

- удаление параметра из родительского конфига достигается добавлением к названию параметра префикса "remove~":

```yaml
remove~foo: ~
```

- замена параметра осуществляется с помощью префикса "override~", причем заменить можно только параметры-массивы, т. к.
 скаляры заменяются по умолчанию:

```yaml
view:
    index:
        override~fields:
            bar: ~
```

- для определения порядка параметров существуют префиксы "before~" и "after~":

```yaml
view:
    index:
        fields:
            before~bar~foo: ~
            after~bar~baz:  ~
```

В данном примере параметр "foo" будет помещен перед параметром "bar", а "baz" - после "bar".

**2. Регистрируем раздел администрирования в секции "sections" [настроек](reference/configuration.md) бандла.**

Каждый раздел описывается четырьмя параметрами:

- **alias** - уникальный псевдоним раздела, если не указан, сгенерируется автоматически;
- **entity** - класс сущности, для администрирования которой создается раздел (обязательный параметр);
- **config** - путь до файла конфигурации, если не указан, то будет создана только
 [конфигурация безопасности](security_configurations.md), создание же непосредственно раздела администрирования
 останется на вас;
- **enabled** - активен ли раздел (по умолчанию - true).

Путь до файла конфигурации может быть относительным бандла, в таком случае он должен начинаться с "@", например
 "@DarvinAdminBundle/Resources/config/admin/image.yml".

Пример:

```yaml
darvin_admin:
    sections:
        -
            alias:  log
            entity: Darvin\AdminBundle\Entity\LogEntry
            config: @DarvinAdminBundle/Resources/config/admin/log.yml
```

Конфигурация любого раздела может быть переопределена в главном конфиге приложения (app/config/config.yml). Для этого нужно
 добавить в секцию "sections" конфигурацию с параметром "entity", соответствующим переопределяемой конфигурации.

Пример отключения раздела администрирования:

```yaml
darvin_admin:
    sections:
        -
            entity:  Darvin\AdminBundle\Entity\LogEntry
            enabled: false
```

**Примечания**

Менеджер метаданных по умолчанию кэширует метаданные и возвращает версии из кэша. Поэтому все внесенные в конфигурацию
 раздела администрирования изменения активируются только после чисти кэша. Чтобы отключить это поведение, необходимо
  включить отладку панели администрирования, установив параметр [конфигурации](reference/configuration.md)
 "darvin_admin.debug" бандла равным true. Имеет смысл сделать это для dev-окружения (обычно настраивается в app/config/config_dev.yml):

```yaml
darvin_admin:
    debug: true
```

Пример получения метаданных из менеджера метаданных:

```php
$metadata = $this->getContainer()->get('darvin_admin.metadata.manager')->getMetadata('Darvin\\AdminBundle\\Entity\\Administrator');
```

*В менеджере метаданных присутствует также ряд других методов, с которыми полезно ознакомиться.*

После создания сервиса-метаданных раздела администрирования, становится возможным использование следующих сервисов,
 оперирующих метаданными:

- **darvin_admin.metadata.identifier_accessor** - сервис получения идентификатора сущности на основе метаданных ее
 раздела администрирования;
- **darvin_admin.metadata.sort_criteria_detector** - сервис определения критерия сортировки для сущности на основе
 метаданных ее раздела администрирования.
